
in real time

we had 3 stages to create a infrastrcture

1 -->
git repo + packer.json + *.tf files 

2 -->
run packer for custom ami
3 -->
deploy infra using terraform


above stages we don't do in manually for automation purpose we need one tool that tool is jenkins or azue devops


before we going jenkins we need to know packer
ref url:https://www.packer.io/

download packer
sample code realtime packer :
ref url: https://github.com/rajeshsingamsetti/Devopscompletetuts/blob/main/sir-terraform-packer-jenkins/packer.json

***** why we need packers meanes
to create only an image or ami (it's diff between packer and terraform will create overall infrastrcture)
image creation means

first ec2 machine will crete after update after stop after it will create one ami (but using this ami packer won't create another ami it will done by terraform)

terraform will use the machine image of created by packer
lets start with packer install on mac or linux
locate into 
cd /usr/local/bin
wget https://releases.hashicorp.com/packer/1.6.5/packer_1.6.5_darwin_amd64.zip


sample packer.json file will be like this

{
    "_comment" : "Create a AWS AMI ith AMZ Linux 2018 with Java and Tomcat",
    "variables": {
      "aws_access_key": "",
      "aws_secret_key": "",
      "region": "",
      "source_ami":"",
      "instance_type":"",
      "vpc_id": "",
      "subnet_id": ""
    },
    "_comment1" : "packer build -var \"aws_secret_key=foo\" template.json",
    "_comment2" : "packer build -var-file creds.json template.json",
    "builders": [{
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "type": "amazon-ebs",
      "region": "{{user `region`}}",
      "source_ami": "{{user `source_ami`}}",
      "instance_type": "{{user `instance_type`}}",
      "ssh_username": "ec2-user",
      "ami_name": "DevOpsClass-Build-{{isotime | clean_resource_name}}",
      "vpc_id": "{{user `vpc_id`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "tags": {
        "Name": "DevOpsClass-Build-{{isotime | clean_resource_name}}"
      }
    }],
    "provisioners": [{
      "type": "shell",
      "inline": [
        "sleep 30",
        "sudo yum update -y",
        "sudo yum install nginx -y",
        "sudo yum install git -y",
        "sudo git clone https://github.com/mavrick202/webhooktesting.git",
        "sudo rm -rf /usr/share/nginx/html/index.html",
        "sudo cp webhooktesting/index.html /usr/share/nginx/html/index.html",
        "sudo cp webhooktesting/style.css /usr/share/nginx/html/style.css",
        "sudo cp webhooktesting/scorekeeper.js /usr/share/nginx/html/scorekeeper.js",
        "sudo service nginx start",
        "sudo chkconfig nginx on"
        ]
    }]
  }


here we need to change the ami number and region & instance type will t2.micro






